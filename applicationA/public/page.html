<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <meta http-equiv="X-Frame-Options: allow-from 'http://localhost:5000'>  -->
    <title>Document</title>
    <style>

      .ifame-container {
        margin: 10px auto;
        width: 80%;
        height: 600px;
      }
    </style>
</head>
<body>
    <div>
      <label for="change-store">Change Store Context</label>
      <select id="change-store" onchange="handleStoreChange(event)">
        <option value="store1">Store 1</option>
        <option value="store2">Store 2</option>
        <option value="store3">Store 3</option>
      </select>
    </div>
    <div>
      <iframe src="https://swym-mud-dev.azurewebsites.net/" class="ifame-container" name="appB" id="appB"></iframe>
    </div>

    <script type="text/javascript">
      let iframeWindow = window.frames.appB;
      const StoreConfigs = {
        "store1": {
          "pid": "merchant pid1",
          "endpoint": "https://xxx-store-xxx.swymrelay.com",
          "loggedInUser": {
            "username": "adminuser@store1.com"
          },
          "apps": {
            "Wishlist": true,
            "Watchlist": true
          },
          "platform": "Shopify",
          "validationTokenForUser": "xxx",
        },
        "store2": {
          "pid": "merchant pid2",
          "endpoint": "https://xxx-store-xxx.swymrelay.com",
          "loggedInUser": {
            "username": "adminuser@store2.com"
          },
          "apps": {
            "Wishlist": true,
            "Watchlist": true
          },
          "platform": "Shopify",
          "validationTokenForUser": "xxx",
        },
        "store3": {
          "pid": "merchant pid3",
          "endpoint": "https://xxx-store-xxx.swymrelay.com",
          "loggedInUser": {
            "username": "adminuser@store3.com"
          },
          "apps": {
            "Wishlist": true,
            "Watchlist": true
          },
          "platform": "Shopify",
          "validationTokenForUser": "xxx",
        }
      }
      function handleStoreChange(event) {
        const val = event.target.value;
        const storeCfg = StoreConfigs[val]
        const eventJson = {
          "topic": "swym-merchant-changed",
          "payload": storeCfg,
          "timestamp": Date.now()
        }
        iframeWindow.postMessage(JSON.stringify(eventJson), location.origin);
      }

      // win.postMessage("message", "http://localhost:5000/page.html");
      window.addEventListener('message', function(event) {
        if (event.origin != 'https://swym-mud-dev.azurewebsites.net'){
            return;
        }
        alert(`Received ${event.data}`);
      });
    </script>
</body>
</html>
